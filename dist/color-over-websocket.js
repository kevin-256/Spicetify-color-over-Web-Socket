(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var e,t,o,s,i,r,n,a,c,l,p,d,u,g,f,b,m,w,h,v,y,x,S,L,E;function C(){var e=localStorage.getItem(S);return null!==e?JSON.parse(e):null}function k(){Spicetify.PopupModal.display({title:"Set up Web Socket connection",content:h.default.createElement(x,null),isLarge:!0})}async function N(){var e=C();if(e){if(e.enabled)if(e.serverIp&&e.serverPort)try{var t=Spicetify.Player.data.item,r=(await Spicetify.colorExtractor(t.uri)).DESATURATED;o===r?console.debug("Same color, not changing"):(o=r,(async(e,r)=>{try{let t=new WebSocket("ws://127.0.0.1:"+e);t.onopen=()=>{var e={red:r[0],green:r[1],blue:r[2]};t.send(JSON.stringify(e)),t.close()},console.debug("Set lights to "+r)}catch(e){console.error("Failed to send message to the server:",e),Spicetify.showNotification("Failed to send message to the server",!0)}})((e.serverIp,e.serverPort),L(r)))}catch(e){console.error("Error changing lights:",e),Spicetify.showNotification("Failed to change lights",!0)}else Spicetify.showNotification("Web Socket Server settings incomplete",!1,3e3)}else Spicetify.showNotification("No Web Socket Server settings found",!1,3e3)}s=Object.create,i=Object.defineProperty,r=Object.defineProperties,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,p=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,g=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f=(e,t)=>{for(var r in t=t||{})d.call(t,r)&&g(e,r,t[r]);if(l)for(var r of l(t))u.call(t,r)&&g(e,r,t[r]);return e},b=(e,t)=>r(e,a(t)),e={"external-global-plugin:react"(e,t){t.exports=Spicetify.React}},h=(m=(e,t,r)=>(r=null!=e?s(p(e)):{},((t,r,o,s)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let e of c(r))d.call(t,e)||e===o||i(t,e,{get:()=>r[e],enumerable:!(s=n(r,e))||s.enumerable});return t})(!t&&e&&e.__esModule?r:i(r,"default",{value:e,enumerable:!0}),e)))((w=function(){return t||(0,e[c(e)[0]])((t={exports:{}}).exports,t),t.exports})()),v=m(w()),y=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,x=()=>{let[t,n]=(0,v.useState)({enabled:!0,serverIp:"127.0.0.1",serverPort:8080}),[,r]=(0,v.useState)(""),[e,i]=(0,v.useState)(""),o=((0,v.useEffect)(()=>{var e=C();e&&n(e)},[]),e=>y.test(e)),a=e=>0<=e&&e<=65535;return v.default.createElement("div",{className:"ws-settings"},v.default.createElement("div",{className:"container"},v.default.createElement("form",{onSubmit:e=>{if(e.preventDefault(),o(t.serverIp))if(a(t.serverPort))try{localStorage.setItem(S,JSON.stringify(t)),Spicetify.showNotification("Settings saved successfully",!1),Spicetify.PopupModal.hide()}catch(e){console.error("Error saving settings:",e),Spicetify.showNotification("Failed to save settings",!0)}else i("Port must be from 0 to 65535"),Spicetify.showNotification("Port must be from 0 to 65535",!0);else r("Ip must be x.y.z.w"),Spicetify.showNotification("Ip must be x.y.z.w",!0)}},v.default.createElement("div",{className:"setting-row"},v.default.createElement("div",{className:"setting-content"},v.default.createElement("label",{htmlFor:"enabled"},"Enable Color over Web Socket Extension"),v.default.createElement("label",{className:"switch"},v.default.createElement("input",{type:"checkbox",id:"enabled",name:"enabled",checked:t.enabled,onChange:e=>{let{name:t,value:r,type:o,checked:s}=e.target,i="checkbox"===o?s:r;n(e=>b(f({},e),{[t]:i}))}}),v.default.createElement("span",{className:"slider round"}))),v.default.createElement("div",{className:"description"},"Turn the extension on or off")),v.default.createElement("div",{className:"setting-row"},v.default.createElement("div",{className:"setting-content"},v.default.createElement("label",{htmlFor:"serverPort"},"Web Socket server port"),v.default.createElement("input",{type:"text",placeholder:"8080",id:"serverPort",name:"serverPort",value:t.serverPort,onChange:e=>{let t=e.target.name;var r=Number(e.target.value),o=e.target.type,e=e.target.checked;let s="checkbox"===o?e:r;"serverPort"===t&&r&&!a(r)?i("Port must be from 0 to 65535"):i(""),n(e=>b(f({},e),{[t]:s}))},required:!0,className:e?"error":""})),v.default.createElement("div",{className:"description"},e&&v.default.createElement("div",{className:"error-message"},e),"Enter the port of your Web Socket server (e.g., 8080).")),v.default.createElement("div",{className:"button-row"},v.default.createElement("button",{type:"submit"},"Save")))))},S="ws-settings",L=e=>{e=e.replace(/^#/,"");e=parseInt(e,16);return[e>>16&255,e>>8&255,255&e]},E=function(){Spicetify.Player.addEventListener("songchange",N),Spicetify.Player.addEventListener("onplaypause",e=>{null!=e&&e.data.isPaused||N()}),new Spicetify.Menu.Item("Web Socket Settings",!1,k,`<?xml version="1.0" encoding="UTF-8"?>
      <svg width="16" height="16" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M21.25,4.0020191 C21.6296958,4.0020191 21.943491,4.28417298 21.9931534,4.65024855 L22,4.7520191 L22,19.2520191 C22,19.6317149 21.7178461,19.9455101 21.3517706,19.9951725 L21.25,20.0020191 L2.75,20.0020191 C2.37030423,20.0020191 2.05650904,19.7198652 2.00684662,19.3537897 L2,19.2520191 L2,4.7520191 C2,4.37232334 2.28215388,4.05852814 2.64822944,4.00886572 L2.75,4.0020191 L21.25,4.0020191 Z M6,12.5010191 L3.5,12.5010191 L3.5,18.502 L20.5,18.502 L20.5,12.5010191 L18,12.5010191 L18,16.25 C18,16.6642136 17.6642136,17 17.25,17 C16.8703042,17 16.556509,16.7178461 16.5068466,16.3517706 L16.5,16.25 L16.5,12.5010191 L14.5,12.5010191 L14.5,16.25 C14.5,16.6642136 14.1642136,17 13.75,17 C13.3703042,17 13.056509,16.7178461 13.0068466,16.3517706 L13,16.25 L13,12.5010191 L11,12.5010191 L11,16.25 C11,16.6642136 10.6642136,17 10.25,17 C9.87030423,17 9.55650904,16.7178461 9.50684662,16.3517706 L9.5,16.25 L9.5,12.5010191 L7.5,12.5010191 L7.5,16.25 C7.5,16.6642136 7.16421356,17 6.75,17 C6.37030423,17 6.05650904,16.7178461 6.00684662,16.3517706 L6,16.25 L6,12.5010191 Z M20.5,5.502 L3.5,5.502 L3.5,11.001 L20.5,11.001 L20.5,5.502 Z M9.25,7.50193212 C9.66421356,7.50193212 10,7.83771856 10,8.25193212 C10,8.66614568 9.66421356,9.00193212 9.25,9.00193212 C8.83578644,9.00193212 8.5,8.66614568 8.5,8.25193212 C8.5,7.83771856 8.83578644,7.50193212 9.25,7.50193212 Z M17.25,7.50092257 C17.6642136,7.50092257 18,7.836709 18,8.25092257 C18,8.63061833 17.7178461,8.94441353 17.3517706,8.99407595 L17.25,9.00092257 L14.75,9.00092257 C14.3357864,9.00092257 14,8.66513613 14,8.25092257 C14,7.8712268 14.2821539,7.55743161 14.6482294,7.50776918 L14.75,7.50092257 L17.25,7.50092257 Z M6.25,7.5 C6.66421356,7.5 7,7.83578644 7,8.25 C7,8.66421356 6.66421356,9 6.25,9 C5.83578644,9 5.5,8.66421356 5.5,8.25 C5.5,7.83578644 5.83578644,7.5 6.25,7.5 Z" id="ðŸŽ¨-Color"></path>
      </svg>
    `).register()},(async()=>{await E()})(),(async()=>{var e;document.getElementById("colorDoverDwebsocket")||((e=document.createElement("style")).id="colorDoverDwebsocket",e.textContent=String.raw`
  .ws-settings .container{max-width:600px;margin:0 auto}.ws-settings .setting-row{margin-bottom:20px}.ws-settings .setting-row .setting-content{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}.ws-settings .setting-row .setting-content label{flex:0 0 auto;margin-right:10px;font-weight:700}.ws-settings .setting-row .description{font-size:.9em;color:var(--spice-subtext)}.ws-settings .setting-row input[type=password],.ws-settings .setting-row input[type=url]{flex:1 1 auto;width:100%;max-width:300px;padding:10px;border:none;background-color:var(--spice-sidebar);color:var(--spice-text);border-radius:8px}.ws-settings .button-row{text-align:right}.ws-settings .button-row button{background-color:var(--spice-text);color:var(--spice-main);border:none;padding:13px 30px;border-radius:500px;cursor:pointer;transition:background-color .3s}.ws-settings .button-row button:hover{filter:brightness(90%)}.ws-settings .switch{position:relative;display:inline-block;width:60px;height:34px}.ws-settings .switch input{opacity:0;width:0;height:0}.ws-settings .switch .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--spice-subtext);transition:.4s;border-radius:34px}.ws-settings .switch .slider:before{position:absolute;content:"";height:26px;width:26px;left:4px;bottom:4px;background-color:#fff;transition:.4s;border-radius:50%}.ws-settings .switch input:checked+.slider{background-color:var(--spice-text)}.ws-settings .switch input:checked+.slider:before{transform:translateX(26px);background-color:var(--spice-subtext)}.ws-settings input[type=url].error{border:solid;border-width:2px;border-color:var(--spice-notification-error)}.ws-settings .error-message{color:var(--spice-notification-error)}
      `.trim(),document.head.appendChild(e))})()})();